<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../partials/head'); %>
</head>

<body>
    <%- include('../partials/sidebar'); %>

      <div class="custom-container">
        <div class="row">
          <!-- All Table -->
          <div class="table-responsive">
            <!-- Pagination -->
            <nav aria-label="Page navigation">
              <ul class="pagination justify-content-center">
                <% const totalPages = 253; // Total number of pages %>
                <% const currentPage = parseInt(req.query.page) || 1; // Current page %>
                <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                  <a class="page-link" href="?page=<%= currentPage - 1 %>" tabindex="-1" aria-disabled="true">Previous</a>
                </li>
                <% const startPage = Math.max(1, currentPage - 2); %>
                <% const endPage = Math.min(totalPages, startPage + 4); %>
                <% for (let i = startPage; i <= endPage; i++) { %>
                  <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                    <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                  </li>
                <% } %>
                <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                  <a class="page-link" href="?page=<%= currentPage + 1 %>">Next</a>
                </li>
              </ul>
            </nav>
            <% if (locals.all_data) { %>
            <table class="table table-sm table-hover border border shadow" id="allTable" style="text-align: center;">
              <thead>
                <tr style="--bs-table-bg: #b8b8b8; --bs-table-color: #434343;">
                  <th scope="col">Sequence</th>
                  <th scope="col">VIN</th>
                  <th scope="col">Year</th>
                  <th scope="col">Trim</th>
                  <th scope="col">Body</th>
                  <th scope="col">Transmission</th>
                  <th scope="col">Exterior Color</th>
                  <th scope="col">MSRP</th>
                  <th scope="col">Country</th>
                  <th scope="col">Dealer</th>
                </tr>
              </thead>
              <tbody>
                <% locals.all_data.forEach(function(data) { %>
                  <tr style="cursor: pointer;" onmousedown="handleMouseDown(event);" onclick="handleRowClick('/search?vin=<%= data.VIN %>');">
                    <td scope="row"><%= data.SEQUENCE %></td>
                    <td scope="row"><%= data.VIN %></td>
                    <td scope="row"><%= data.YEAR %></td>
                    <td scope="row"><%= data.TRIM %></td>
                    <td scope="row"><%= data.BODY %></td>
                    <td scope="row"><%= data.TRANS %></td>
                    <td scope="row"><%= data.COLOR %></td>
                    <td scope="row" style="text-align: right;" class="msrp"><span class="accounting"><%= data.MSRP %></span></td>
                    <td scope="row">
                      <% if (data.STATE === "AB" || data.STATE === "BC" || data.STATE === "MB" || data.STATE === "NB" || data.STATE === "NF" || data.STATE === "NS" || data.STATE === "NT" || data.STATE === "OH" || data.STATE === "ON" || data.STATE === "PE" || data.STATE === "PQ" || data.STATE === "SK") { %>
                        <img src="../img/canada_flag.png" alt="Canada" width="20">
                      <% } else { %>
                        <img src="../img/usa_flag.png" alt="USA" width="20"
                      <% } %>
                    </td>
                    <td scope="row"><%= data.DEALER %></td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let startX;

    function handleMouseDown(event) {
      // Store the starting X coordinate of the mouse
      startX = event.clientX;
    }

    function handleRowClick(url) {
      // Calculate the horizontal distance the mouse has moved
      const distance = Math.abs(event.clientX - startX);

      // If the mouse has moved more than 5 pixels horizontally, consider it as text selection
      if (distance > 5) {
        return;
      }

      // Navigate to the specified URL
      window.location.href = url;
    }
  </script>
</body>

</html>
